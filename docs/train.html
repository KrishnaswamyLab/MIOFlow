---

title: Train


keywords: fastai
sidebar: home_sidebar

summary: "API details."
description: "API details."
nb_path: "05_train.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: 05_train.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="train" class="doc_header"><code>train</code><a href="https://github.com/dsm-72/ToyTrajectoryNet/tree/main/ToyTrajectoryNet/train.py#L17" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>train</code>(<strong><code>model</code></strong>, <strong><code>df</code></strong>, <strong><code>groups</code></strong>, <strong><code>optimizer</code></strong>, <strong><code>n_batches</code></strong>, <strong><code>criterion</code></strong>=<em><code>MMD_loss()</code></em>, <strong><code>use_cuda</code></strong>=<em><code>False</code></em>, <strong><code>sample_size</code></strong>=<em><code>(100,)</code></em>, <strong><code>sample_with_replacement</code></strong>=<em><code>False</code></em>, <strong><code>local_loss</code></strong>=<em><code>True</code></em>, <strong><code>global_loss</code></strong>=<em><code>False</code></em>, <strong><code>hold_one_out</code></strong>=<em><code>False</code></em>, <strong><code>hold_out</code></strong>=<em><code>'random'</code></em>, <strong><code>apply_losses_in_time</code></strong>=<em><code>True</code></em>, <strong><code>top_k</code></strong>=<em><code>5</code></em>, <strong><code>hinge_value</code></strong>=<em><code>0.01</code></em>, <strong><code>use_density_loss</code></strong>=<em><code>True</code></em>, <strong><code>use_local_density</code></strong>=<em><code>False</code></em>, <strong><code>lambda_density</code></strong>=<em><code>1.0</code></em>, <strong><code>lambda_density_local</code></strong>=<em><code>1.0</code></em>, <strong><code>geo_emb</code></strong>=<em><code>None</code></em>, <strong><code>use_emb</code></strong>=<em><code>True</code></em>, <strong><code>use_gaussian</code></strong>:<code>bool</code>=<em><code>True</code></em>, <strong><code>add_noise</code></strong>:<code>bool</code>=<em><code>True</code></em>, <strong><code>noise_scale</code></strong>:<code>float</code>=<em><code>0.3</code></em>, <strong><code>logger</code></strong>=<em><code>None</code></em>, <strong><code>autoencoder</code></strong>=<em><code>None</code></em>, <strong><code>n_samples</code></strong>=<em><code>1</code></em>, <strong><code>use_penalty</code></strong>=<em><code>False</code></em>, <strong><code>lambda_energy</code></strong>=<em><code>1.0</code></em>)</p>
</blockquote>
<p>Training loop for Stupid Simple ODE</p>
<p>Notes:</p>

<pre><code>- The argument `model` must have a method `forward` that accepts two arguments
    in its function signature:
        ```python
        model.forward(x, t)
        ```
    where, `x` is the input tensor and `t` is an `torch.Tensor` of time points (float).

</code></pre>
<p>Arguments:
    model (nn.Module): the initialized pytorch ODE model.</p>

<pre><code>df (pd.DataFrame): the DataFrame from which to extract batch data.

groups (list): the list of the numerical groups in the data, e.g.
    `[1.0, 2.0, 3.0, 4.0, 5.0]`, if the data has five groups.

optimizer (torch.optim): an optimizer initilized with the model's parameters.

criterion (Callable | nn.Loss): a loss function.

n_batches (int): the number of batches from which to randomly sample each consecutive pair
    of groups.

use_cuda (bool): Defaults to `False`. Whether or not to send the model and data to cuda.

sample_size (tuple): Defaults to `(100, )`

sample_with_replacement (bool): Defaults to `True`. Whether or not to sample data points with replacement.

local_loss (bool): Defaults to `True`. Whether or not to use a local loss in the model.
    See notes for more detail.

global_loss (bool): Defaults to `False`. Whether or not to use a global loss in the model.

hold_one_out (bool): Defaults to `False`. Whether or not to randomly hold one time pair
    e.g. t_1 to t_2 out when computing the global loss.

hold_out (str | int): Defaults to `"random"`. Which time point to hold out when calculating the
    global loss.

apply_losses_in_time (bool): Defaults to `True`. Applies the losses and does back propegation
    as soon as a loss is calculated. See notes for more detail.

top_k (int): The k for the k-NN used in the density loss.

hinge_value (float): The hinge value for density loss. Defaults to `0.01`.

use_density_loss (bool): Defaults to `True`. Whether or not to add density regularization.

lambda_density (float): the weight for density loss. Defaults to `1.0`.

geo_emb (nn.Module): the trained geodesic embedding model

use_emb (bool): Defaults to `True`. Whether or not to use the embedding model.

use_gaussian (bool): Defaults to `True`. Whether to use random or gaussian noise.

add_noise (bool): Defaults to `True`. Whether or not to add noise.

noise_scale (float): Defaults to `0.30`. How much to scale the noise by.

use_penalty (bool): Defaults to `True`. Whether or not to use $L_e$ during training (norm of the derivative).

lambda_energy (float): weight of the energy penalty</code></pre>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="train_emb" class="doc_header"><code>train_emb</code><a href="https://github.com/dsm-72/ToyTrajectoryNet/tree/main/ToyTrajectoryNet/train.py#L292" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>train_emb</code>(<strong><code>model</code></strong>, <strong><code>decoder</code></strong>, <strong><code>df</code></strong>, <strong><code>groups</code></strong>, <strong><code>optimizer</code></strong>, <strong><code>optimizer_decode</code></strong>, <strong><code>n_epochs</code></strong>=<em><code>60</code></em>, <strong><code>criterion</code></strong>=<em><code>MSELoss()</code></em>, <strong><code>geo_dist</code></strong>=<em><code>&lt;ToyTrajectoryNet.geo.DiffusionDistance object at 0x7f0d0c956040&gt;</code></em>, <strong><code>use_cuda</code></strong>=<em><code>True</code></em>, <strong><code>sample_size</code></strong>=<em><code>(100,)</code></em>, <strong><code>sample_with_replacement</code></strong>=<em><code>False</code></em>, <strong><code>w_recon</code></strong>=<em><code>1.0</code></em>, <strong><code>noise_min_scale</code></strong>=<em><code>0</code></em>, <strong><code>noise_max_scale</code></strong>=<em><code>1.0</code></em>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="train_ae" class="doc_header"><code>train_ae</code><a href="https://github.com/dsm-72/ToyTrajectoryNet/tree/main/ToyTrajectoryNet/train.py#L342" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>train_ae</code>(<strong><code>model</code></strong>, <strong><code>df</code></strong>, <strong><code>groups</code></strong>, <strong><code>optimizer</code></strong>, <strong><code>n_epochs</code></strong>=<em><code>60</code></em>, <strong><code>criterion</code></strong>=<em><code>MSELoss()</code></em>, <strong><code>dist</code></strong>=<em><code>None</code></em>, <strong><code>recon</code></strong>=<em><code>True</code></em>, <strong><code>use_cuda</code></strong>=<em><code>True</code></em>, <strong><code>sample_size</code></strong>=<em><code>(100,)</code></em>, <strong><code>sample_with_replacement</code></strong>=<em><code>False</code></em>, <strong><code>noise_min_scale</code></strong>=<em><code>0.0</code></em>, <strong><code>noise_max_scale</code></strong>=<em><code>1.0</code></em>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

</div>
 

